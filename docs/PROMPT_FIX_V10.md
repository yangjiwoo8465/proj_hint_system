# 프롬프트 수정 V10 - Coder 모델 특성 고려 (코드 제거)

## 문제 상황 (V9 실패)

### V9 테스트 결과

**생성된 출력:**
```
N, M = map(int, input().split())
board = []
for _ in range(N):
    board.append(input())

결과 출력:
TypeError: 'str' object is not callable

예외 발생 이유:
.board.append(board[i]) 에서 인덱스 i 가 out of
```

**필터링 결과:**
```
[DEBUG] 영어 문장 감지 필터링: ['board', 'board', 'TypeError']
```

**문제:**
- ❌ **질문이 아닌 코드 생성** - 모델이 코드 디버깅 모드로 전환
- ❌ **에러 메시지 출력** - TypeError, 예외 설명
- ❌ **영어 단어 사용** - 변수명, 에러명

---

## 근본 원인 분석

### Qwen2.5-Coder 모델의 특성

**모델 이름:**
- Qwen2.5-**Coder**-1.5B
- **Coder** → 코드 작성/디버깅에 특화된 모델

**모델 동작 방식:**
1. 프롬프트에 코드가 보임
2. "이 코드를 고쳐야지!" 모드 활성화
3. 디버깅/코드 수정 시작
4. 질문 생성 무시

### V9 프롬프트의 치명적 실수

```python
# V9 프롬프트
학생이 작성한 코드:
{user_code}  # ← 코더 모델에게 코드를 보여줌!

다음 단계 (학생이 구현해야 하는 Logic):
{next_step_goal}
```

**왜 실패했나?**

| 요소 | Coder 모델의 반응 |
|------|-------------------|
| `학생이 작성한 코드:` | "코드 리뷰 모드!" |
| `{user_code}` | "이 코드를 분석하자!" |
| `다음 단계` | "다음 코드를 작성하자!" |

**결과:**
- 질문 생성 X
- 코드 디버깅 O

---

## 해결책: 코드 컨텍스트 제거

### 핵심 전략

**Coder 모델에게 코드를 보여주지 마라!**

| Before (V9) | After (V10) |
|-------------|-------------|
| `학생이 작성한 코드: {user_code}` | ❌ 코드 제거 |
| "다음 단계 (Logic)" | "아직 못한 부분" |
| 풍부한 컨텍스트 | 최소 컨텍스트 |

---

## V9 vs V10 비교

### V9 프롬프트 (Before)

```python
상황:
이 문제의 정답 코드는 여러 Logic으로 나뉩니다.
학생은 지금까지 일부 Logic은 구현했지만, "{next_step_goal}"를 아직 구현하지 못했습니다.

학생이 작성한 코드:
{user_code}  # ← 코더 모델 트리거!

다음 단계 (학생이 구현해야 하는 Logic):
{next_step_goal}

임무:
학생의 현재 코드로는 "{next_step_goal}"를 할 수 없다는 것을 깨닫게 만드는 질문을 작성하세요.
학생이 스스로 "{next_step_goal}"의 필요성을 발견하도록 구체적인 상황/불편함을 제시하세요.
```

**길이:** 약 45줄
**코드 포함:** ✅ (user_code)
**Logic Step 언급:** ✅
**문제점:** Coder 모델이 코드 보고 디버깅 모드 진입

---

### V10 프롬프트 (After)

```python
너는 학생에게 힌트를 주는 선생님이다.

상황 설명:
- 학생이 코딩 문제를 풀고 있다
- 학생은 일부는 구현했지만 "{next_step_goal}"를 아직 못했다
- 학생이 스스로 "{next_step_goal}"의 필요성을 깨닫도록 질문 1개를 만들어라

절대 금지 (중요!):
1. 코드 작성 금지 - 질문만 만들어라
2. 개념 질문 금지 - "함수가 뭐야?", "반복문이 뭐야?" 같은 거 금지
3. 교육적 표현 금지 - "중요한 단계", "핵심 개념", "이해하기" 금지
4. 코드 문법 언급 금지 - def, for, if, while, list 같은 거 쓰지 마
5. 영어/백틱 금지 - 오직 한국어 반말만
6. "{next_step_goal}"를 직접 말하지 마 - 상황으로 유도해

질문 만드는 방법:
1. 구체적 숫자로 불편한 상황 만들기
   - "여러 개"(X) → "10개", "100번"(O)

2. 직접 체감하는 불편함
   - "좋은 방법?"(X) → "손으로 100번 쓸 건데?"(O)

3. 확장 상황 제시
   - "입력 2개가 아니라 100개면?"

질문 예시:
좋은 질문:
- "같은 계산 10번 해야 하는데 코드 10번 복사?"
- "나중에 숫자 바꾸면 10군데 찾아서 수정?"
- "입력 100개면 어떻게 처리?"

나쁜 질문:
- "함수가 뭐야?" (개념 질문)
- "중요한 건?" (교육적)
- "어떻게 개선?" (정답 유도)

출력:
한국어 반말 질문 1개 (물음표 필수, 구체적 숫자 포함)

질문:
```

**길이:** 약 43줄
**코드 포함:** ❌ (제거)
**Logic Step 언급:** △ (간소화: "일부는 구현, 일부는 못함")
**개선점:**
1. **"코드 작성 금지"** 명시
2. **"질문만 만들어라"** 강조
3. 짧고 직접적인 명령

---

## 주요 변경 사항

### 1. 역할 명시

**V9:**
```python
상황:
이 문제의 정답 코드는 여러 Logic으로 나뉩니다.
```

**V10:**
```python
너는 학생에게 힌트를 주는 선생님이다.
```

**의도:** Coder 모델이 "코드 작성자"가 아닌 **"선생님"** 역할 인식

---

### 2. 코드 제거

**V9:**
```python
학생이 작성한 코드:
{user_code}
```

**V10:**
```python
# 코드 완전 제거
```

**이유:** Coder 모델이 코드를 보면 디버깅 모드 진입

---

### 3. "코드 작성 금지" 명시

**V10 신규:**
```python
절대 금지 (중요!):
1. 코드 작성 금지 - 질문만 만들어라
```

**의도:** Coder 모델에게 명시적으로 **"코드 쓰지 마!"**

---

### 4. Logic Step 간소화

**V9:**
```python
상황:
이 문제의 정답 코드는 여러 Logic으로 나뉩니다.
학생은 지금까지 일부 Logic은 구현했지만, "{next_step_goal}"를 아직 구현하지 못했습니다.

다음 단계 (학생이 구현해야 하는 Logic):
{next_step_goal}
```

**V10:**
```python
상황 설명:
- 학생이 코딩 문제를 풀고 있다
- 학생은 일부는 구현했지만 "{next_step_goal}"를 아직 못했다
- 학생이 스스로 "{next_step_goal}"의 필요성을 깨닫도록 질문 1개를 만들어라
```

**개선:**
- "Logic" 용어 제거 (Coder 모델에게 너무 기술적)
- 불릿 포인트로 간결화
- "질문 1개 만들어라" 직접 명령

---

### 5. 예시 간소화

**V9:**
```python
좋은 질문 예시 (이렇게 하세요):
- "같은 계산을 10군데에서 해야 하는데 코드 10번 복사할 건가?"
- "나중에 계산 방식 바꾸면 10군데 다 찾아서 수정해?"
- "입력이 2개가 아니라 100개면 어떻게 처리할 건데?"
- "이 검사를 5군데에서 써야 하는데 매번 복붙?"
```

**V10:**
```python
좋은 질문:
- "같은 계산 10번 해야 하는데 코드 10번 복사?"
- "나중에 숫자 바꾸면 10군데 찾아서 수정?"
- "입력 100개면 어떻게 처리?"
```

**개선:**
- 불필요한 문구 제거 ("이렇게 하세요")
- 문장 단축 (Coder 모델이 복사하기 어렵게)
- 3개로 축소 (4개 → 3개)

---

## 핵심 철학 변화

### V9: 컨텍스트 풍부 → 실패

**전략:**
- Logic Step 개념 설명
- 학생 코드 제공
- 상세한 임무 설명

**결과:**
- Coder 모델 혼란
- 코드 디버깅 시작
- 질문 생성 실패

---

### V10: 컨텍스트 최소화 → 기대

**전략:**
- 코드 완전 제거
- "코드 작성 금지" 명시
- 짧고 직접적인 명령

**기대 효과:**
- Coder 모델 역할 인식 ("선생님")
- 코드 모드 비활성화
- 질문 생성 집중

---

## Coder 모델 대응 전략

### 일반적 프롬프트 엔지니어링

```python
# 일반 모델 (GPT, Claude)
상황:
[풍부한 컨텍스트]

학생 코드:
[코드 전체]

임무:
[상세한 설명]
```

**특징:**
- 컨텍스트가 많을수록 좋음
- 코드를 보여줘도 OK
- 상세한 설명 선호

---

### Coder 모델 특화 전략 (V10)

```python
# Coder 모델 (Qwen2.5-Coder)
너는 [역할]이다.

상황:
- [간단한 설명]
- [next_step_goal]을 못했다

절대 금지:
1. 코드 작성 금지!
2. 질문만 만들어라!

질문 예시:
[3개 간단 예시]

출력:
[명확한 포맷]
```

**특징:**
- **코드 제거** 필수
- **"코드 금지"** 명시
- 짧고 직접적인 명령
- 역할 명시 ("선생님")

---

## 사용자 요구사항 충족 여부

### ✅ N개 Logic 분할

**V9:**
```
이 문제의 정답 코드는 여러 Logic으로 나뉩니다.
```

**V10:**
```
학생은 일부는 구현했지만 "{next_step_goal}"를 아직 못했다
```

→ **간소화했지만 의미 유지** (일부 구현 = M번째까지, 못함 = M+1번째)

---

### ✅ M번째 Logic 틀린 경우

**V10:**
```
질문 만드는 방법:
1. 구체적 숫자로 불편한 상황 만들기
2. 직접 체감하는 불편함
```

→ **유지** (현재 코드의 한계 제시)

---

### ✅ M+1번째 Logic 유도

**V10:**
```
3. 확장 상황 제시
   - "입력 2개가 아니라 100개면?"
   - "문제 조건 바뀌면 또 처음부터?"
```

→ **유지** (확장 상황으로 다음 단계 필요성 유도)

---

### ✅ 소크라테스 학습법

**V10:**
```
- 학생이 스스로 "{next_step_goal}"의 필요성을 깨닫도록 질문 1개를 만들어라
```

→ **유지** ("스스로 깨닫도록")

---

## 트레이드오프 (Trade-off)

### 잃은 것

| 항목 | V9 | V10 |
|------|----|----|
| 학생 코드 | ✅ 제공 | ❌ 제거 |
| Logic 용어 | ✅ 명시 | △ 간소화 |
| 상세 설명 | ✅ 풍부 | △ 간결 |

---

### 얻은 것

| 항목 | V9 | V10 |
|------|----|----|
| 코드 작성 방지 | ❌ | ✅ "코드 금지" 명시 |
| 역할 인식 | △ | ✅ "선생님" 명시 |
| Coder 모델 대응 | ❌ | ✅ 코드 제거 |

---

## 기대 효과

### V9 출력 (실패)
```
N, M = map(int, input().split())
board = []
...
TypeError: 'str' object is not callable
```
→ 코드 디버깅

---

### V10 기대 출력
```
같은 검사를 10번 해야 하는데 매번 손으로 쓸 건가?
```
또는
```
입력 100개면 어떻게 처리할 건데?
```
→ 소크라테스식 질문

---

## V1 → V10 전체 변천사

| 버전 | 핵심 전략 | Coder 모델 대응 | 결과 |
|------|-----------|-----------------|------|
| V1-V7 | 예시 제거, 간소화 | ❌ | 막연한 질문 |
| V8 | 개념 질문 차단 | ❌ | Logic Step 없음 |
| V9 | Logic Step 기반 | ❌ | **코드 디버깅 시작** |
| **V10** | **코드 제거** | ✅ | 질문 생성 기대 |

---

## 핵심 교훈

### Coder 모델의 특성

**특화 모델 (Qwen2.5-Coder):**
- 코드를 보면 → 디버깅 모드
- 코드를 빼면 → 질문 생성 가능

**프롬프트 전략:**
1. **코드 제거** - 가장 중요
2. **"코드 금지" 명시** - 명시적 지시
3. **역할 부여** - "선생님" 역할
4. **짧고 직접적** - 간단 명령

---

## 변경 위치

**파일:** [hint-system/app.py](../hint-system/app.py#L322-L366)
**함수:** `_create_analysis_prompt()`
**라인:** 322-366

---

## 테스트 필요

### 검증 포인트

1. **코드 생성 차단**
   - 모델이 코드를 출력하지 않는지

2. **질문 생성**
   - "~할 건가?" 형태의 질문 생성되는지

3. **구체적 숫자**
   - "10개", "100번" 같은 구체적 숫자 사용하는지

4. **개념 질문 차단**
   - "함수가 뭐야?" 같은 질문 여전히 차단되는지

5. **영어 차단**
   - 한국어만 출력되는지

---

**작성일:** 2025-01-30
**버전:** V10 (Coder 모델 특화)
**이전 버전:** [PROMPT_FIX_V9.md](PROMPT_FIX_V9.md)
**핵심 개선:** Coder 모델 특성 고려, 코드 컨텍스트 제거
