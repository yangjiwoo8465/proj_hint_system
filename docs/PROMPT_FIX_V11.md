# 프롬프트 수정 V11 - Few-shot 예시 중심 (초단순)

## 문제 상황 (V10 실패)

### Chat 모델 테스트 결과 (Qwen2.5-1.5B-Instruct)

**생성된 출력:**
```
"당신이 이 프로그램을 돌리는데, '합'이라는 함수를 사용해야 합니다.
그런데 당신이 'if'문과 'for'문을 몇 번 각각 썼습니까?"
```

**문제:**
1. ❌ **함수명 언급** - "'합'이라는 함수"
2. ❌ **코드 문법 언급** - 'if'문, 'for'문, 'def'
3. ❌ **프롬프트 금지사항 완전 무시**

**V10 프롬프트:**
```python
절대 금지 (중요!):
4. 코드 문법 언급 금지 - def, for, if, while, list 같은 거 쓰지 마
```

→ **완전히 무시됨**

---

## 근본 원인 분석

### 작은 모델의 한계

**1.5B-2B 모델의 특성:**
- 복잡한 제약 조건 이해 어려움
- "금지" 같은 부정 명령보다 **"예시"를 더 잘 따라함**
- 긴 프롬프트 (40줄+) 처리 어려움

### V10 프롬프트의 문제

**구조:**
```
1. 역할 설명 (3줄)
2. 상황 설명 (4줄)
3. 절대 금지 (6개 항목, 8줄)
4. 질문 만드는 방법 (3개 항목, 9줄)
5. 질문 예시 (좋은 예시 3개, 나쁜 예시 3개, 12줄)
6. 출력 형식 (2줄)
```

**총 길이:** ~43줄

**문제점:**
- 너무 길고 복잡
- "금지" 항목이 너무 많음 (6개)
- 모델이 중요한 부분 놓침

---

## 해결책: Few-shot Learning

### Few-shot Learning이란?

**정의:**
- 긴 설명 대신 **예시 몇 개**만 제시
- 모델이 예시에서 패턴 학습
- "이렇게 해" > "저렇게 하지 마"

### 프롬프트 설계 원칙 변경

| 원칙 | Before (V10) | After (V11) |
|------|--------------|-------------|
| **접근** | 규칙 기반 | 예시 기반 |
| **길이** | 43줄 | **13줄** |
| **금지사항** | 6개 명시 | 없음 (예시로 대체) |
| **예시** | 6개 (좋은/나쁜) | 3개 (좋은 것만) |

---

## V10 vs V11 비교

### V10 프롬프트 (Before) - 43줄

```python
너는 학생에게 힌트를 주는 선생님이다.

상황 설명:
- 학생이 코딩 문제를 풀고 있다
- 학생은 일부는 구현했지만 "{next_step_goal}"를 아직 못했다
- 학생이 스스로 "{next_step_goal}"의 필요성을 깨닫도록 질문 1개를 만들어라

절대 금지 (중요!):
1. 코드 작성 금지 - 질문만 만들어라
2. 개념 질문 금지 - "함수가 뭐야?", "반복문이 뭐야?" 같은 거 금지
3. 교육적 표현 금지 - "중요한 단계", "핵심 개념", "이해하기" 금지
4. 코드 문법 언급 금지 - def, for, if, while, list 같은 거 쓰지 마
5. 영어/백틱 금지 - 오직 한국어 반말만
6. "{next_step_goal}"를 직접 말하지 마 - 상황으로 유도해

질문 만드는 방법:
1. 구체적 숫자로 불편한 상황 만들기
   - "여러 개"(X) → "10개", "100번"(O)
   - "큰 입력"(X) → "1000줄"(O)

2. 직접 체감하는 불편함
   - "좋은 방법?"(X) → "손으로 100번 쓸 건데?"(O)
   - "효율적으로?"(X) → "나중에 10군데 다 고칠 건데?"(O)

3. 확장 상황 제시
   - "입력 2개가 아니라 100개면?"
   - "문제 조건 바뀌면 또 처음부터?"

질문 예시:
좋은 질문:
- "같은 계산 10번 해야 하는데 코드 10번 복사?"
- "나중에 숫자 바꾸면 10군데 찾아서 수정?"
- "입력 100개면 어떻게 처리?"

나쁜 질문:
- "함수가 뭐야?" (개념 질문)
- "중요한 건?" (교육적)
- "어떻게 개선?" (정답 유도)

출력:
한국어 반말 질문 1개 (물음표 필수, 구체적 숫자 포함)

질문:
```

**문제:**
- 43줄로 너무 길음
- 금지사항 6개 (모델이 처리 못함)
- 좋은 예시 3개 + 나쁜 예시 3개 (혼란)

---

### V11 프롬프트 (After) - 13줄

```python
질문 1개만 만들어.

학생이 "{next_step_goal}"를 못했음.

예시 1 - 반복:
질문: 같은 계산 10번 해야 하는데 매번 손으로?

예시 2 - 재사용:
질문: 나중에 숫자 바꾸면 10군데 다 고칠 건데?

예시 3 - 확장:
질문: 입력 100개면 어떻게 처리?

위처럼 "{next_step_goal}"에 대해 질문 1개. 물음표 필수.

질문:
```

**개선:**
- **13줄로 초단순** (43줄 → 13줄, 70% 감소)
- **금지사항 0개** (규칙 대신 예시)
- **좋은 예시만 3개** (나쁜 예시 제거)
- **핵심만** (질문 패턴 학습에 집중)

---

## 핵심 변경 사항

### 1. 금지사항 제거

**V10:**
```python
절대 금지 (중요!):
1. 코드 작성 금지
2. 개념 질문 금지
3. 교육적 표현 금지
4. 코드 문법 언급 금지  # ← 완전 무시됨
5. 영어/백틱 금지
6. "{next_step_goal}" 직접 말하지 마
```

**V11:**
```python
# 금지사항 없음
# 예시만 보여주면 모델이 자연스럽게 따라함
```

**철학:**
- "하지 마" (❌) → "이렇게 해" (✅)
- 부정 명령 < 긍정 예시

---

### 2. 좋은 예시만 제시

**V10:**
```python
좋은 질문:
- "같은 계산 10번..."
- "나중에 숫자 바꾸면..."
- "입력 100개면..."

나쁜 질문:  # ← 혼란 유발
- "함수가 뭐야?"
- "중요한 건?"
- "어떻게 개선?"
```

**V11:**
```python
예시 1 - 반복:
질문: 같은 계산 10번 해야 하는데 매번 손으로?

예시 2 - 재사용:
질문: 나중에 숫자 바꾸면 10군데 다 고칠 건데?

예시 3 - 확장:
질문: 입력 100개면 어떻게 처리?
```

**이유:**
- 나쁜 예시 = 모델이 혼란스러워함
- 좋은 예시만 = 명확한 패턴

---

### 3. 프롬프트 압축

**V10 구조 (43줄):**
```
1. 역할 설명 (3줄)
2. 상황 설명 (4줄)
3. 금지사항 (8줄)
4. 방법론 (9줄)
5. 예시 (12줄)
6. 출력 형식 (2줄)
7. "질문:" (1줄)
```

**V11 구조 (13줄):**
```
1. 명령 (1줄): "질문 1개만 만들어"
2. 상황 (1줄): "{next_step_goal}를 못했음"
3. 예시 (9줄): 3개 패턴
4. 재확인 (1줄): "위처럼..."
5. "질문:" (1줄)
```

**압축률:**
- 70% 감소 (43줄 → 13줄)
- 핵심만 남김

---

### 4. Few-shot 패턴

**Few-shot Learning 적용:**

```
예시 1 - [카테고리]:
질문: [구체적 질문]

예시 2 - [카테고리]:
질문: [구체적 질문]

예시 3 - [카테고리]:
질문: [구체적 질문]

위처럼 [task]에 대해 질문 1개.
```

**장점:**
- 모델이 패턴 즉시 인식
- 카테고리로 다양성 학습
- 간결하고 명확

---

## Few-shot vs Zero-shot vs Instruction-based

### Zero-shot (V6)

```python
질문을 한국어 반말로 작성하세요.
물음표로 끝나야 합니다.
구체적 숫자를 포함하세요.
```

**문제:** 너무 막연함

---

### Instruction-based (V10)

```python
절대 금지:
1. 코드 작성 금지
2. 개념 질문 금지
3. 교육적 표현 금지

질문 만드는 방법:
1. 구체적 숫자 사용
2. 직접 체감 불편
3. 확장 상황 제시
```

**문제:** 규칙이 너무 많음

---

### Few-shot (V11)

```python
예시 1:
질문: 같은 계산 10번 해야 하는데 매번 손으로?

예시 2:
질문: 나중에 숫자 바꾸면 10군데 다 고칠 건데?

위처럼 질문 1개.
```

**장점:**
- 명확한 패턴
- 규칙 없어도 이해
- 작은 모델도 따라함

---

## 기대 효과

### V10 출력 (실패)

```
"당신이 이 프로그램을 돌리는데, '합'이라는 함수를 사용해야 합니다.
그런데 당신이 'if'문과 'for'문을 몇 번 각각 썼습니까?"
```

→ 함수명 언급, 코드 문법 (if, for) 언급

---

### V11 기대 출력

```
같은 검사 10번 해야 하는데 매번 손으로?
```

또는

```
나중에 조건 바꾸면 10군데 다 고칠 건데?
```

또는

```
입력 100개면 어떻게 처리?
```

→ 예시 패턴 따라함

---

## V1 → V11 전체 변천사

| 버전 | 전략 | 길이 | 예시 | 결과 |
|------|------|------|------|------|
| V1-V4 | 예시 제거 | ~30줄 | 완전 예시 | 예시 복사 |
| V5 | 추상적 원칙 | ~25줄 | 없음 | 막연함 |
| V6 | 초간단 명령 | ~15줄 | 없음 | 영어 혼란 |
| V7 | 대조 학습 | ~30줄 | 좋은/나쁜 | 여전히 추상 |
| V8 | 개념 차단 | ~35줄 | 좋은/나쁜 | Logic Step 없음 |
| V9 | Logic Step | ~45줄 | 좋은/나쁜 | **코드 디버깅** |
| V10 | 코드 제거 | ~43줄 | 좋은/나쁜 | **함수명 언급** |
| **V11** | **Few-shot** | **13줄** | **좋은 것만** | 테스트 필요 |

---

## 핵심 교훈

### 작은 모델 프롬프팅 원칙

**1. 짧게**
- 40줄+ (❌) → 15줄- (✅)
- 핵심만 남기기

**2. 예시로**
- 규칙 설명 (❌) → 구체적 예시 (✅)
- "하지 마" < "이렇게 해"

**3. 긍정적**
- 금지사항 나열 (❌) → 좋은 예시만 (✅)
- 부정 명령 < 긍정 예시

**4. 패턴 명확**
- 다양한 설명 (❌) → 일관된 형식 (✅)
- Few-shot 패턴

---

## Few-shot 프롬프팅 가이드

### 기본 구조

```python
[간단한 지시] 1줄

[상황 설명] 1-2줄

예시 1 - [카테고리]:
[출력 형식]: [예시 내용]

예시 2 - [카테고리]:
[출력 형식]: [예시 내용]

예시 3 - [카테고리]:
[출력 형식]: [예시 내용]

[재확인] 1줄

[출력 시작]:
```

**총 길이:** 10-15줄

---

### 예시 작성 원칙

**1. 다양성**
- 3개 예시 = 3가지 다른 패턴
- V11: "반복", "재사용", "확장"

**2. 구체성**
- 추상적 (❌): "효율적 방법?"
- 구체적 (✅): "10번 복사?"

**3. 일관성**
- 모든 예시가 같은 형식
- "질문: [내용]"

---

## 변경 위치

**파일:** [hint-system/app.py](../hint-system/app.py#L347-L364)
**함수:** `_create_analysis_prompt()`
**라인:** 347-364

---

## 테스트 필요

### 검증 포인트

1. **패턴 따르기**
   - 예시와 비슷한 구조로 생성되는지
   - "~하는데 ~?"  패턴

2. **구체적 숫자**
   - "10개", "100번" 같은 숫자 사용하는지

3. **함수명/문법 회피**
   - 예시에 없으니 자연스럽게 회피될 것

4. **한국어 반말**
   - 예시가 모두 반말이므로 따라할 것

5. **물음표**
   - 모든 예시가 `?`로 끝남

---

## 사용자 요구사항 충족

| 요구사항 | V11 대응 |
|----------|----------|
| M+1 Logic 유도 | ✅ 예시로 학습 |
| 소크라테스 학습법 | ✅ "~하는데?" 패턴 |
| 구체적 상황 | ✅ "10번", "10군데" |
| 개념 질문 회피 | ✅ 예시에 없음 |
| 함수명 회피 | ✅ 예시에 없음 |

---

**작성일:** 2025-01-30
**버전:** V11 (Few-shot)
**이전 버전:** [PROMPT_FIX_V10.md](PROMPT_FIX_V10.md)
**핵심 개선:** 43줄 → 13줄, 규칙 제거, Few-shot 예시만
**철학:** "하지 마" < "이렇게 해"
