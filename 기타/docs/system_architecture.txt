═══════════════════════════════════════════════════════════════════════════════
                    개인화된 힌트 시스템 - 시스템 아키텍처
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                          FRONTEND LAYER (React)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ MyPage   │  │ Admin    │  │ Coding   │  │ Problems │  │ Chatbot  │   │
│  │          │  │ Panel    │  │ Test     │  │          │  │          │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
│                       │                                                      │
│                 ┌─────┴──────┐                                             │
│                 │ UsersTab   │                                             │
│                 │ (실력 지표  │                                             │
│                 │  관리 UI)  │                                             │
│                 └────────────┘                                             │
│                                                                              │
│  • React 18 + Redux (상태 관리)                                            │
│  • Monaco Editor (코드 편집)                                               │
│  • React Router (라우팅)                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ HTTP Requests (REST API)
                                      ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                    REST API LAYER (Django REST Framework)                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  /api/v1/auth/*      /api/v1/coding-test/*      /api/v1/admin/*           │
│        │                      │                         │                   │
│   ┌────┴─────┐         ┌─────┴────────┐         ┌──────┴────────┐        │
│   │ login    │         │ /hint/       │         │ /users/       │        │
│   │ signup   │         │ /problems/   │         │ /users/{id}/  │        │
│   │ logout   │         │ /submit/     │         │ /users/{id}/  │        │
│   └──────────┘         └──────────────┘         │   skill/      │        │
│                                                   └───────────────┘        │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ Django ORM
                                      ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                   BACKEND LAYER (Django Applications)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │Authentication│  │ Coding Test  │  │ Admin Panel  │  │   Chatbot    │ │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤ │
│  │ • views.py   │  │ • hint_api.py│  │ • views.py   │  │ • views.py   │ │
│  │ • models.py  │  │ • views.py   │  │ • urls.py    │  │ • models.py  │ │
│  │ • serializ.. │  │ • models.py  │  │              │  │              │ │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                 │
                    ↓                 ↓                 ↓
┌──────────────────────────┐  ┌─────────────────────────────────────────────┐
│   DATA MODELS LAYER      │  │         BUSINESS LOGIC LAYER                │
├──────────────────────────┤  ├─────────────────────────────────────────────┤
│                          │  │                                             │
│  ┌────────────────────┐ │  │  ┌────────────────────────────────────────┐│
│  │ User               │ │  │  │ 1. 실력 점수 계산                       ││
│  ├────────────────────┤ │  │  │    calculate_difficulty_score()        ││
│  │ + skill_score      │ │  │  │    • 힌트 요청 시간                     ││
│  │ + skill_mode       │ │  │  │    • 힌트 요청 횟수                     ││
│  │ + hint_level       │ │  │  │    • 코드 실행 횟수                     ││
│  │ + rating           │ │  │  │    • 코드 길이                          ││
│  │ + email            │ │  │  └────────────────────────────────────────┘│
│  │ + created_at       │ │  │                      ↓                      │
│  └────────────────────┘ │  │  ┌────────────────────────────────────────┐│
│                          │  │  │ 2. 힌트 레벨 자동 조정                 ││
│  ┌────────────────────┐ │  │  │    update_skill_score()                ││
│  │ ProblemSession     │ │  │  │    • 최근 10개 세션 평균               ││
│  ├────────────────────┤ │  │  │    • 점수 >= 70 → 레벨 1              ││
│  │ + started_at       │ │  │  │    • 점수 40~70 → 레벨 2              ││
│  │ + first_hint_at    │ │  │  │    • 점수 < 40 → 레벨 3               ││
│  │ + first_run_at     │ │  │  └────────────────────────────────────────┘│
│  │ + solved_at        │ │  │                      ↓                      │
│  │ + hint_count       │ │  │  ┌────────────────────────────────────────┐│
│  │ + run_count        │ │  │  │ 3. 개인화 프롬프트 생성                ││
│  │ + max_code_length  │ │  │  │    hint_api.py:54-152                  ││
│  │ + is_solved        │ │  │  │                                         ││
│  └────────────────────┘ │  │  │  if user.hint_level == 1:              ││
│                          │  │  │    # 구체적 힌트                        ││
│  ┌────────────────────┐ │  │  │    # 함수명 직접 언급                   ││
│  │ Problem            │ │  │  │                                         ││
│  ├────────────────────┤ │  │  │  elif user.hint_level == 2:            ││
│  │ + problem_id       │ │  │  │    # 개념 힌트                          ││
│  │ + title            │ │  │  │    # 자료구조/알고리즘                  ││
│  │ + level            │ │  │  │                                         ││
│  │ + description      │ │  │  │  else:  # level 3                      ││
│  │ + solution_code    │ │  │  │    # 소크라테스식 질문                  ││
│  │ + examples         │ │  │  │                                         ││
│  └────────────────────┘ │  │  └────────────────────────────────────────┘│
│                          │  │                      ↓                      │
│  ┌────────────────────┐ │  │  ┌────────────────────────────────────────┐│
│  │ HintRequest        │ │  │  │ 4. AI 모델 호출                        ││
│  ├────────────────────┤ │  │  │    Hugging Face Inference Providers    ││
│  │ + user             │ │  │  │    • Qwen 2.5 Coder 7B/32B            ││
│  │ + problem          │ │  │  │    • max_tokens: 200                   ││
│  │ + hint_level       │ │  │  │    • temperature: 0.7                  ││
│  │ + user_code        │ │  │  └────────────────────────────────────────┘│
│  │ + hint_response    │ │  │                                             │
│  │ + model_used       │ │  └─────────────────────────────────────────────┘
│  └────────────────────┘ │
│                          │
└──────────────────────────┘
            │
            │ ORM Mapping
            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DATABASE LAYER (PostgreSQL)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────┐  ┌──────────────────┐  ┌──────────────┐  ┌────────────┐ │
│  │ users       │  │ problem_sessions │  │ problems     │  │ hint_req.. │ │
│  │             │  │                  │  │              │  │            │ │
│  │ Primary Key:│  │ Foreign Keys:    │  │ Primary Key: │  │ Foreign    │ │
│  │   id        │◄─┤   user_id       │  │   id         │◄─┤   Keys:    │ │
│  │             │  │   problem_id    ├─►│              │  │   user_id  │ │
│  │ New Fields: │  │                  │  │              │  │   prob..id │ │
│  │ skill_score │  │ Unique:          │  │              │  │            │ │
│  │ skill_mode  │  │ (user, problem)  │  │              │  │            │ │
│  │ hint_level  │  │                  │  │              │  │            │ │
│  └─────────────┘  └──────────────────┘  └──────────────┘  └────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          EXTERNAL SERVICES                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────┐        ┌────────────────────────┐ │
│  │  Hugging Face Inference Providers  │        │  Docker / Docker Compose│ │
│  ├────────────────────────────────────┤        ├────────────────────────┤ │
│  │  Endpoint:                         │        │  Services:             │ │
│  │  router.huggingface.co/v1/         │        │  • backend (Django)    │ │
│  │    chat/completions                │        │  • frontend (React)    │ │
│  │                                    │        │  • database (Postgres) │ │
│  │  Models:                           │        │                        │ │
│  │  • Qwen/Qwen2.5-Coder-7B-Instruct │        │  Networking:           │ │
│  │  • Qwen/Qwen2.5-Coder-32B-Instruct│        │  • Internal network    │ │
│  │                                    │        │  • Port mapping        │ │
│  │  Rate Limit:                       │        │                        │ │
│  │  • 30,000 calls/month (free tier) │        └────────────────────────┘ │
│  │                                    │                                    │
│  │  Request Format:                   │                                    │
│  │  {                                 │                                    │
│  │    "model": "...",                │                                    │
│  │    "messages": [...],             │                                    │
│  │    "max_tokens": 200,             │                                    │
│  │    "temperature": 0.7             │                                    │
│  │  }                                │                                    │
│  └────────────────────────────────────┘                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                              DATA FLOW DIAGRAM
═══════════════════════════════════════════════════════════════════════════════

[사용자 힌트 요청 플로우]

1. User clicks "힌트" button in CodingTest page
         │
         ↓
2. Frontend sends POST request to /api/v1/coding-test/hint/
   { problem_id: "...", user_code: "..." }
         │
         ↓
3. hint_api.py receives request
         │
         ├──→ Retrieves user.hint_level (1, 2, or 3)
         │
         ├──→ Loads problem data from JSON
         │
         ├──→ Generates prompt based on hint_level:
         │    • Level 1: Concrete hints with function names
         │    • Level 2: Conceptual hints without function names
         │    • Level 3: Socratic questioning
         │
         ↓
4. Sends request to Hugging Face API
   • Endpoint: router.huggingface.co/v1/chat/completions
   • Model: Qwen 2.5 Coder 7B or 32B
   • Prompt: Generated based on hint_level
         │
         ↓
5. Receives AI-generated hint response
         │
         ├──→ Saves HintRequest record to database
         │    (user, problem, hint_level, user_code, hint_response)
         │
         ├──→ Updates ProblemSession (if exists):
         │    • first_hint_at (if first time)
         │    • hint_count++
         │
         ↓
6. Returns hint to Frontend
   { success: true, data: { hint: "...", problem_id: "..." } }
         │
         ↓
7. Frontend displays hint to user in Chatbot panel


[관리자 실력 지표 수정 플로우]

1. Admin opens AdminPanel → UsersTab
         │
         ↓
2. Frontend calls GET /api/v1/admin/users/
   • Returns all users with skill metrics
         │
         ↓
3. Admin clicks "실력 수정" button for a user
   • Enters edit mode
         │
         ├──→ Selects skill_mode: "manual"
         ├──→ Inputs skill_score: 75.5
         └──→ Selects hint_level: 1 (레벨 1 - 기초)
         │
         ↓
4. Admin clicks "저장" button
         │
         ↓
5. Frontend sends PATCH /api/v1/admin/users/{id}/skill/
   { skill_score: 75.5, skill_mode: "manual", hint_level: 1 }
         │
         ↓
6. Backend validates and updates User model
   • skill_score = 75.5
   • skill_mode = "manual"
   • hint_level = 1
         │
         ↓
7. User's next hint request uses Level 1 prompts
   (Concrete hints with function names)


[자동 실력 점수 갱신 플로우 - 향후 구현]

1. User solves a problem
         │
         ↓
2. ProblemSession.solved_at is set
   ProblemSession.is_solved = True
         │
         ↓
3. System calls user.update_skill_score()
         │
         ├──→ Checks if user.skill_mode == "auto"
         │    (If "manual", skip update)
         │
         ├──→ Retrieves last 10 ProblemSessions
         │
         ├──→ For each session, calculates difficulty_score:
         │    • Hint request time score: 0-30 points
         │    • Hint count score: 0-30 points
         │    • Run count score: 0-20 points
         │    • Code length score: 0-20 points
         │    • Total: 0-100 (higher = more difficult)
         │
         ├──→ Calculates average difficulty score
         │
         ├──→ Updates user.skill_score with average
         │
         └──→ Auto-adjusts user.hint_level:
              • score >= 70 → hint_level = 1 (기초)
              • 40 <= score < 70 → hint_level = 2 (보통)
              • score < 40 → hint_level = 3 (실력자)
         │
         ↓
4. User's next hint request uses updated hint_level


═══════════════════════════════════════════════════════════════════════════════
                              기술 스택 요약
═══════════════════════════════════════════════════════════════════════════════

┌──────────────────┬───────────────────────────────────────────────────────┐
│ Layer            │ Technologies                                          │
├──────────────────┼───────────────────────────────────────────────────────┤
│ Frontend         │ • React 18.2.0                                       │
│                  │ • Redux + Redux Toolkit (상태 관리)                  │
│                  │ • React Router 6 (라우팅)                            │
│                  │ • Monaco Editor (코드 편집기)                        │
│                  │ • Axios (HTTP 클라이언트)                            │
├──────────────────┼───────────────────────────────────────────────────────┤
│ Backend          │ • Django 4.2                                         │
│                  │ • Django REST Framework                              │
│                  │ • Python 3.10+                                       │
│                  │ • PostgreSQL 15 (database)                           │
├──────────────────┼───────────────────────────────────────────────────────┤
│ AI/ML            │ • Hugging Face Inference Providers                   │
│                  │ • Qwen 2.5 Coder 7B/32B models                       │
│                  │ • OpenAI-compatible Chat Completion API              │
├──────────────────┼───────────────────────────────────────────────────────┤
│ Infrastructure   │ • Docker + Docker Compose                            │
│                  │ • Nginx (reverse proxy)                              │
│                  │ • Git (version control)                              │
├──────────────────┼───────────────────────────────────────────────────────┤
│ Development      │ • Vite (frontend bundler)                            │
│                  │ • ESLint (code linting)                              │
│                  │ • Python Black (code formatting)                     │
└──────────────────┴───────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                              보안 고려사항
═══════════════════════════════════════════════════════════════════════════════

• Authentication: JWT 토큰 기반 인증
• Authorization: IsAdminUser 권한으로 관리자 API 보호
• API Key Security: Hugging Face API 키는 DB에 암호화 저장
• CORS: 프론트엔드 도메인만 허용
• Rate Limiting: API 호출 제한 (향후 구현)
• Input Validation: 모든 API 요청 데이터 검증
• SQL Injection: Django ORM 사용으로 방지
• XSS: React의 기본 이스케이핑으로 방지

═══════════════════════════════════════════════════════════════════════════════

버전: 1.0
작성일: 2025-01-06
작성자: Claude Code Assistant
